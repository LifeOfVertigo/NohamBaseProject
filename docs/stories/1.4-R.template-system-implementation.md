# Story 1.4-R: Template System Foundation (Complete)

## Status
Deferred - Not needed for current development

## Story
**As a** developer,
**I want** standardized templates for creating new UE5 C++ classes and components,
**so that** all future development follows consistent patterns and AI assistants can predict code structure.

## Context
Story 1.4 was **NOT IMPLEMENTED** in original Epic 1 work. This story implements the complete template system from scratch per original Story 1.4 specification.

**CRITICAL:** This story has ZERO existing implementation. The `.bmad-core/templates/` directory contains BMAD framework YAML templates (for PRDs/architecture docs), NOT UE5 C++ code templates.

## Acceptance Criteria
1. C++ class templates created for common UE5 component types (Subsystem, Component, Actor, Widget, GameMode)
2. Header and implementation file templates follow established naming conventions
3. Template generation Python script provided for rapid class creation
4. Example subsystem created demonstrating template usage
5. Documentation explaining template patterns and usage guidelines
6. AI prompt templates created for code generation assistance

## Tasks / Subtasks

### Create Template Directory Structure (AC: 1, 2)
- [ ] Create `templates/cpp/` directory in project root
  - Separate from `.bmad-core/templates/` (which is for YAML docs)
  - Add README.md explaining purpose
- [ ] Create subdirectories for each template type:
  - `templates/cpp/subsystem/` - Engine/Game subsystem templates
  - `templates/cpp/component/` - ActorComponent templates
  - `templates/cpp/actor/` - Actor templates
  - `templates/cpp/widget/` - UUserWidget templates
  - `templates/cpp/gamemode/` - GameModeBase templates
  - `templates/cpp/data/` - Plain struct/data templates

### Create Subsystem Template (AC: 1, 2)
- [ ] Create `templates/cpp/subsystem/SubsystemTemplate.h.template`
  - Template variables: `{{CLASS_NAME}}`, `{{MODULE_NAME}}`, `{{DESCRIPTION}}`
  - Inherit from `UEngineSubsystem` (or `UGameInstanceSubsystem` variant)
  - Include standard UCLASS macro with comments
  - Include Initialize/Deinitialize function declarations
  - Include example console command function
  - Include proper header guard with template variable
  - Add comprehensive header comments explaining purpose
- [ ] Create `templates/cpp/subsystem/SubsystemTemplate.cpp.template`
  - Template variables matching header
  - Include implementation of Initialize/Deinitialize
  - Include example console command implementation
  - Add logging examples using project categories
  - Include comments explaining common subsystem patterns
- [ ] Create `templates/cpp/subsystem/SubsystemTemplate-GameInstance.h.template`
  - Variant that inherits from `UGameInstanceSubsystem`
  - Use when subsystem needs per-game-instance scope
  - Otherwise same structure as engine subsystem

### Create Component Template (AC: 1, 2)
- [ ] Create `templates/cpp/component/ComponentTemplate.h.template`
  - Template variables: `{{CLASS_NAME}}`, `{{MODULE_NAME}}`, `{{DESCRIPTION}}`
  - Inherit from `UActorComponent`
  - Include standard UCLASS macro
  - Include BeginPlay/EndPlay/TickComponent declarations
  - Include example UPROPERTY declarations (EditAnywhere, BlueprintReadOnly)
  - Include example UFUNCTION declarations (BlueprintCallable)
  - Add proper header guard
- [ ] Create `templates/cpp/component/ComponentTemplate.cpp.template`
  - Matching template variables
  - Constructor with PrimaryComponentTick setup
  - BeginPlay/EndPlay implementations
  - TickComponent implementation with delta time
  - Example property initialization
  - Comments explaining component lifecycle

### Create Actor Template (AC: 1, 2)
- [ ] Create `templates/cpp/actor/ActorTemplate.h.template`
  - Template variables: `{{CLASS_NAME}}`, `{{MODULE_NAME}}`, `{{DESCRIPTION}}`
  - Inherit from `AActor`
  - Include standard UCLASS macro
  - Include BeginPlay/Tick declarations
  - Include example component declarations (UStaticMeshComponent, etc.)
  - Include example UPROPERTY and UFUNCTION declarations
  - Add proper header guard
- [ ] Create `templates/cpp/actor/ActorTemplate.cpp.template`
  - Matching template variables
  - Constructor with PrimaryActorTick and component setup
  - BeginPlay implementation
  - Tick implementation
  - Example component initialization using CreateDefaultSubobject
  - Comments explaining actor patterns

### Create Widget Template (AC: 1, 2)
- [ ] Create `templates/cpp/widget/WidgetTemplate.h.template`
  - Template variables: `{{CLASS_NAME}}`, `{{MODULE_NAME}}`, `{{DESCRIPTION}}`
  - Inherit from `UUserWidget`
  - Include standard UCLASS macro
  - Include NativeConstruct/NativeDestruct declarations
  - Include example widget binding declarations (UPROPERTY with BindWidget)
  - Include example button click handler (UFUNCTION)
  - Add note about NEON integration for Epic 2
- [ ] Create `templates/cpp/widget/WidgetTemplate.cpp.template`
  - Matching template variables
  - NativeConstruct implementation
  - Example widget binding verification
  - Example button handler implementation
  - Comments explaining widget patterns
  - Note about transition to NEON widgets

### Create GameMode Template (AC: 1, 2)
- [ ] Create `templates/cpp/gamemode/GameModeTemplate.h.template`
  - Template variables: `{{CLASS_NAME}}`, `{{MODULE_NAME}}`, `{{DESCRIPTION}}`
  - Inherit from `AGameModeBase`
  - Include standard UCLASS macro
  - Include BeginPlay/InitGame declarations
  - Include example player spawn override
  - Include example game state management functions
- [ ] Create `templates/cpp/gamemode/GameModeTemplate.cpp.template`
  - Matching template variables
  - Constructor with default pawn class setup
  - BeginPlay implementation
  - InitGame implementation
  - Comments explaining game mode patterns

### Create Data Structure Template (AC: 1, 2)
- [ ] Create `templates/cpp/data/StructTemplate.h.template`
  - Template variables: `{{STRUCT_NAME}}`, `{{MODULE_NAME}}`, `{{DESCRIPTION}}`
  - Use USTRUCT macro for reflection support
  - Include example properties with UPROPERTY
  - Include BlueprintType specifier for Blueprint access
  - Include example constructor
  - Add comments explaining when to use structs vs classes

### Create Template Generation Script (AC: 3)
- [ ] Create `Scripts/generate-class.py`
  - Python 3.8+ compatible
  - Command-line interface with argparse
  - Arguments: --type (subsystem|component|actor|widget|gamemode|struct)
  - Arguments: --name (class name, e.g., "SettingsManager")
  - Arguments: --module (default: "Noham_Base_Proj_Cpp")
  - Arguments: --description (optional description for comments)
  - Arguments: --output-dir (optional, default: auto-detect based on type)
- [ ] Implement template variable substitution
  - Load template files based on --type argument
  - Replace {{CLASS_NAME}} with proper UE5 prefix (A/U/F based on type)
  - Replace {{MODULE_NAME}} with provided module name
  - Replace {{DESCRIPTION}} with provided description
  - Generate proper header guard (e.g., NOHAM_BASE_PROJ_CPP_SETTINGSMANAGER_H)
  - Handle uppercase/lowercase conversions for API macro
- [ ] Implement file path generation
  - Subsystems â†’ `Source/{Module}/Public/Subsystems/{Category}/` and `Private/Subsystems/{Category}/`
  - Components â†’ `Source/{Module}/Public/Components/{Category}/` and `Private/Components/{Category}/`
  - Actors â†’ `Source/{Module}/Public/Actors/` and `Private/Actors/`
  - Widgets â†’ `Source/{Module}/Public/UI/Widgets/` and `Private/UI/Widgets/`
  - GameModes â†’ `Source/{Module}/Public/Subsystems/Core/` and `Private/Subsystems/Core/`
  - Structs â†’ `Source/{Module}/Public/Data/` (header only)
- [ ] Add --category argument for subsystems/components
  - Subsystems: Core, Settings, Input, Platform, NEON, Developer
  - Components: Characters, UI
  - Auto-create subdirectories if they don't exist
- [ ] Implement interactive mode (if no arguments provided)
  - Prompt user for template type
  - Prompt for class name
  - Prompt for module name (with default)
  - Prompt for description
  - Prompt for category (if applicable)
  - Show preview of generated files before writing
  - Confirm before creating files
- [ ] Add validation and error handling
  - Validate class name follows UE5 conventions
  - Check if files already exist (prevent overwriting)
  - Validate module directory exists
  - Validate template files exist
  - Provide helpful error messages
- [ ] Add --dry-run flag for testing
  - Show what would be generated without creating files
  - Display file paths and preview first 20 lines of each file

### Implement Example Subsystem (AC: 4)
- [ ] Use generation script to create ExampleSubsystem
  - Run: `python Scripts/generate-class.py --type subsystem --name Example --category Developer`
  - Should create: `Public/Subsystems/Developer/NohamExampleSubsystem.h`
  - Should create: `Private/Subsystems/Developer/NohamExampleSubsystem.cpp`
- [ ] Enhance ExampleSubsystem with demonstration features
  - Add example console command: "ExampleCommand"
  - Add example property: bIsExampleEnabled (UPROPERTY EditAnywhere)
  - Add example function: DoExampleAction() (UFUNCTION BlueprintCallable)
  - Add example logging using LogNohamDeveloper category
  - Add example subsystem-to-subsystem communication (get DeveloperToolsSubsystem)
- [ ] Add comprehensive code comments
  - Explain why certain patterns are used
  - Point to relevant UE5 documentation
  - Provide suggestions for common modifications
  - Reference coding standards document
- [ ] Test ExampleSubsystem functionality
  - Verify subsystem initializes correctly
  - Test console command execution
  - Verify property editing in editor
  - Test Blueprint callable function
  - Verify logging outputs correctly

### Create Template Documentation (AC: 5)
- [ ] Create `templates/README.md`
  - Overview of template system
  - List of available template types
  - When to use each template type
  - Template variable reference
  - Directory structure explanation
- [ ] Create `templates/USAGE.md`
  - Complete guide to using generate-class.py script
  - Command-line examples for each template type
  - Interactive mode walkthrough
  - Common use cases and examples
  - Troubleshooting common issues
- [ ] Create template-specific documentation
  - `templates/cpp/subsystem/README.md` - When to use Engine vs GameInstance subsystem
  - `templates/cpp/component/README.md` - Component lifecycle and best practices
  - `templates/cpp/actor/README.md` - Actor patterns and spawning
  - `templates/cpp/widget/README.md` - Widget patterns, note about NEON transition
  - `templates/cpp/gamemode/README.md` - GameMode responsibilities
- [ ] Create `docs/development/using-templates.md`
  - Integrated into main documentation
  - Links to template system
  - Examples of generated code
  - AI assistant integration tips
  - Best practices for extending templates

### Create AI Prompt Templates (AC: 6)
- [ ] Create `templates/ai-prompts/subsystem-prompt.md`
  - Prompt template for AI to generate subsystem code
  - Include context about project structure
  - Reference coding standards
  - Include UE5 subsystem patterns
  - Example: "Create a subsystem for {purpose} that {requirements}"
- [ ] Create `templates/ai-prompts/component-prompt.md`
  - Prompt template for component generation
  - Include component lifecycle context
  - Reference common component patterns
  - Include UPROPERTY/UFUNCTION examples
- [ ] Create `templates/ai-prompts/actor-prompt.md`
  - Prompt template for actor generation
  - Include spawning and lifecycle context
  - Reference component attachment patterns
- [ ] Create `templates/ai-prompts/widget-prompt.md`
  - Prompt template for UMG widget generation
  - Note about NEON transition in Epic 2
  - Include widget binding patterns
- [ ] Create `templates/ai-prompts/gamemode-prompt.md`
  - Prompt template for game mode generation
  - Include game state management patterns
  - Reference player spawning patterns
- [ ] Create `templates/ai-prompts/README.md`
  - How to use AI prompts with Claude Code
  - Examples of combining prompts with templates
  - Best practices for AI-assisted development

### Update Build Configuration (AC: 1)
- [ ] No changes needed to .Build.cs (Python script is external tool)
- [ ] Add note about regenerating project files after creating new classes
  - Document in USAGE.md
  - Remind users to run "Generate Visual Studio project files"
  - Explain when regeneration is needed vs not needed

### Testing (AC: 3, 4)
- [ ] Test template generation script
  - Test each template type (subsystem, component, actor, widget, gamemode, struct)
  - Test with various class names
  - Test with different categories
  - Test interactive mode
  - Test dry-run mode
  - Test error handling (invalid names, existing files, etc.)
- [ ] Test generated code compilation
  - Generate test class for each template type
  - Build project and verify no compilation errors
  - Verify generated code follows coding standards
  - Check proper header guards generated
  - Verify proper API macros generated
- [ ] Test ExampleSubsystem
  - Verify initialization in editor
  - Test console command execution
  - Test property editing in Details panel
  - Test Blueprint callable function from Blueprint
  - Verify logging outputs to correct category
- [ ] Test AI prompt templates
  - Use prompts with Claude Code to generate code
  - Verify generated code matches project standards
  - Compare AI-generated code vs template-generated code
  - Refine prompts based on results

### Documentation Integration (AC: 5, 6)
- [ ] Update main README.md
  - Add "Creating New Classes" section
  - Link to template system documentation
  - Provide quick start example
- [ ] Update coding-standards.md
  - Reference template system as source of truth
  - Add note about using templates for consistency
  - Link to template documentation
- [ ] Create video/GIF walkthrough (optional but recommended)
  - Show using generate-class.py script
  - Show interactive mode
  - Show compilation and testing of generated class
  - Add to docs/development/ directory

## Dev Notes

### ðŸš¨ CRITICAL: SEPARATION FROM BMAD TEMPLATES
**DO NOT CONFUSE:**
- `.bmad-core/templates/` - BMAD framework templates (YAML for docs) - **EXISTING**
- `templates/cpp/` - UE5 C++ code templates - **NEW, TO BE CREATED**

These are completely separate systems serving different purposes.

### Directory Structure After Implementation
```
NohamBaseProject/
â”œâ”€â”€ .bmad-core/
â”‚   â””â”€â”€ templates/              [EXISTING - BMAD YAML templates]
â”œâ”€â”€ templates/                  [NEW - UE5 C++ templates]
â”‚   â”œâ”€â”€ README.md
â”‚   â”œâ”€â”€ USAGE.md
â”‚   â”œâ”€â”€ cpp/
â”‚   â”‚   â”œâ”€â”€ subsystem/
â”‚   â”‚   â”‚   â”œâ”€â”€ README.md
â”‚   â”‚   â”‚   â”œâ”€â”€ SubsystemTemplate.h.template
â”‚   â”‚   â”‚   â”œâ”€â”€ SubsystemTemplate.cpp.template
â”‚   â”‚   â”‚   â””â”€â”€ SubsystemTemplate-GameInstance.h.template
â”‚   â”‚   â”œâ”€â”€ component/
â”‚   â”‚   â”‚   â”œâ”€â”€ README.md
â”‚   â”‚   â”‚   â”œâ”€â”€ ComponentTemplate.h.template
â”‚   â”‚   â”‚   â””â”€â”€ ComponentTemplate.cpp.template
â”‚   â”‚   â”œâ”€â”€ actor/
â”‚   â”‚   â”‚   â”œâ”€â”€ README.md
â”‚   â”‚   â”‚   â”œâ”€â”€ ActorTemplate.h.template
â”‚   â”‚   â”‚   â””â”€â”€ ActorTemplate.cpp.template
â”‚   â”‚   â”œâ”€â”€ widget/
â”‚   â”‚   â”‚   â”œâ”€â”€ README.md
â”‚   â”‚   â”‚   â”œâ”€â”€ WidgetTemplate.h.template
â”‚   â”‚   â”‚   â””â”€â”€ WidgetTemplate.cpp.template
â”‚   â”‚   â”œâ”€â”€ gamemode/
â”‚   â”‚   â”‚   â”œâ”€â”€ README.md
â”‚   â”‚   â”‚   â”œâ”€â”€ GameModeTemplate.h.template
â”‚   â”‚   â”‚   â””â”€â”€ GameModeTemplate.cpp.template
â”‚   â”‚   â””â”€â”€ data/
â”‚   â”‚       â”œâ”€â”€ README.md
â”‚   â”‚       â””â”€â”€ StructTemplate.h.template
â”‚   â””â”€â”€ ai-prompts/
â”‚       â”œâ”€â”€ README.md
â”‚       â”œâ”€â”€ subsystem-prompt.md
â”‚       â”œâ”€â”€ component-prompt.md
â”‚       â”œâ”€â”€ actor-prompt.md
â”‚       â”œâ”€â”€ widget-prompt.md
â”‚       â””â”€â”€ gamemode-prompt.md
â”œâ”€â”€ Scripts/
â”‚   â””â”€â”€ generate-class.py       [NEW]
â””â”€â”€ docs/
    â””â”€â”€ development/
        â””â”€â”€ using-templates.md  [NEW]
```

### Architecture Context
[Source: docs/architecture/coding-standards.md, docs/architecture/source-tree.md]

**Naming Convention Integration:**
Templates must generate names following UE5 prefix conventions:
- Actors: `ANoham[ClassName]` (e.g., `ANohamExampleActor`)
- UObjects/Components: `UNoham[ClassName]` (e.g., `UNohamExampleSubsystem`)
- Structs: `FNoham[StructName]` (e.g., `FNohamExampleData`)

**File Organization:**
Templates must place files in correct directories per source-tree.md:
- Subsystems â†’ `Private/Subsystems/{Category}/` and `Public/Subsystems/{Category}/`
- Components â†’ `Private/Components/{Category}/` and `Public/Components/{Category}/`
- Actors â†’ `Private/Actors/` and `Public/Actors/`
- Data â†’ `Public/Data/` (header only for structs)

### Python Script Requirements
**Dependencies:**
- Python 3.8+
- Standard library only (no external packages)
- argparse for CLI
- pathlib for path handling
- string.Template for variable substitution

**Template Variable Format:**
- Use `{{VARIABLE_NAME}}` syntax for easy identification
- Variables: `CLASS_NAME`, `MODULE_NAME`, `DESCRIPTION`, `YEAR`, `HEADER_GUARD`, `API_MACRO`

**Example Template Snippet:**
```cpp
// {{DESCRIPTION}}
// Copyright Epic Games, Inc. All Rights Reserved.

#pragma once

#include "CoreMinimal.h"
#include "Subsystems/EngineSubsystem.h"
#include "{{CLASS_NAME}}.generated.h"

UCLASS()
class {{API_MACRO}} U{{CLASS_NAME}} : public UEngineSubsystem
{
    GENERATED_BODY()

public:
    virtual void Initialize(FSubsystemCollectionBase& Collection) override;
    virtual void Deinitialize() override;
};
```

### UE5 C++ Reference
[Source: docs/unreal-engine/]

**Relevant Documentation for Templates:**
- [Common Patterns](docs/unreal-engine/quick-reference/common-patterns.md) - Template basis
- [Essential Macros](docs/unreal-engine/quick-reference/macros.md) - UCLASS, UPROPERTY, UFUNCTION
- [Subsystems](docs/unreal-engine/core-systems/objects.md) - Subsystem patterns
- [Components](docs/unreal-engine/core-systems/components.md) - Component patterns
- [Actors](docs/unreal-engine/core-systems/actors.md) - Actor patterns

### Testing Checklist
- [ ] All template types generate valid code
- [ ] Generated code compiles without errors
- [ ] Generated code follows coding standards
- [ ] Python script handles all argument combinations
- [ ] Interactive mode works correctly
- [ ] Dry-run mode previews correctly
- [ ] Error handling works (invalid input, existing files)
- [ ] ExampleSubsystem demonstrates all patterns
- [ ] AI prompts generate valid code with Claude Code
- [ ] Documentation is complete and accurate
- [ ] File paths generated correctly for each type
- [ ] Header guards generated correctly
- [ ] API macros generated correctly

### Future Enhancements (Post-Epic 1)
**NEON Widget Templates:**
- Create templates for NEON-integrated widgets in Epic 2
- Templates for HTML/CSS/JS components with UE5 bridge
- Templates for shadcn component integration

**Blueprint Templates:**
- Consider Blueprint class templates for common patterns
- Integration with C++ templates for hybrid development

**Advanced Script Features:**
- Auto-detect module name from current directory
- Integration with Git (auto-commit generated files)
- Template customization via config file
- Project-specific template overrides

## Change Log
| Date | Version | Description | Author |
|------|---------|-------------|--------|
| 2025-10-25 | 1.0 | Initial implementation story creation | James (Developer) |

## Dev Agent Record
*This section will be populated by the development agent during implementation*

### Agent Model Used
*To be filled by dev agent*

### Debug Log References
*To be filled by dev agent*

### Completion Notes List
*To be filled by dev agent*

### File List
*To be filled by dev agent - should include:*
- CREATED: templates/ directory structure (30+ files)
- CREATED: Scripts/generate-class.py
- CREATED: NohamExampleSubsystem.h/.cpp (using template)
- CREATED: Multiple README.md files in templates/
- CREATED: AI prompt template files
- CREATED: docs/development/using-templates.md
- MODIFIED: README.md (template system section)
- MODIFIED: coding-standards.md (template reference)

## QA Results
*Results from QA Agent review will be populated here*
