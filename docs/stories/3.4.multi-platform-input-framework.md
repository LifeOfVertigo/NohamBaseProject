# Story 3.4: Multi-Platform Input Framework

**Status:** Draft

## Story

**As a** player using different input devices,
**I want** seamless switching between keyboard/mouse, gamepad, and Steam Deck controls,
**so that** I can play comfortably regardless of my preferred input method or platform.

## Acceptance Criteria

1. Input detection automatically switches between keyboard/mouse and gamepad modes
2. UI prompts dynamically update to show correct input icons for active device
3. All character controller functions mapped for both input types
4. Steam Deck specific input considerations implemented and tested
5. Input settings allow full customization of key bindings and controller mappings

## Tasks / Subtasks

- [ ] Implement automatic input device detection (AC: 1)
  - [ ] Extend InputManagerSubsystem for device switching
  - [ ] Add keyboard/mouse activity detection
  - [ ] Add gamepad activity detection
  - [ ] Implement automatic mode switching logic
  - [ ] Add Steam Deck specific device detection
- [ ] Create dynamic UI prompt system (AC: 2)
  - [ ] Extend NEON UI system for input prompts
  - [ ] Create input icon component library
  - [ ] Implement prompt update system
  - [ ] Add Xbox/PlayStation/Steam Deck icon sets
  - [ ] Test prompt switching responsiveness
- [ ] Map all character functions to input devices (AC: 3)
  - [ ] Create Enhanced Input mapping contexts
  - [ ] Map movement controls for both input types
  - [ ] Map camera controls for gamepad
  - [ ] Map interaction and advanced movement
  - [ ] Test all functions with both input methods
- [ ] Implement Steam Deck optimizations (AC: 4)
  - [ ] Add Steam Deck specific input mappings
  - [ ] Implement Steam Deck button layouts
  - [ ] Test with Steam Deck hardware/emulation
  - [ ] Optimize UI scaling for Steam Deck screen
  - [ ] Validate Steam Input API integration
- [ ] Create comprehensive input settings (AC: 5)
  - [ ] Extend SettingsSubsystem for input customization
  - [ ] Create key binding interface in settings menu
  - [ ] Add controller sensitivity settings
  - [ ] Implement input validation and conflict detection
  - [ ] Add restore defaults functionality

## Dev Notes

**Tech Stack Reference:**
- UE5 Enhanced Input System for advanced input mapping [Source: architecture/tech-stack.md]
- Steam Input API for multi-controller support [Source: architecture/tech-stack.md]
- NEON UI system for dynamic prompt display [Source: architecture/tech-stack.md]
- C++20 for performance-critical input processing [Source: architecture/tech-stack.md]

**Project Structure:**
- Input subsystem: `Source/NohamBaseProject/Private/Subsystems/Input/` [Source: architecture/unified-project-structure.md]
- Input public interfaces: `Source/NohamBaseProject/Public/Subsystems/Input/` [Source: architecture/unified-project-structure.md]
- UI integration: `Content/UI/NEON/Components/` [Source: architecture/unified-project-structure.md]
- Settings integration: `Source/NohamBaseProject/Private/Subsystems/Settings/` [Source: architecture/unified-project-structure.md]

**InputManagerSubsystem Architecture:**
- Multi-platform input detection and controller switching [Source: architecture/components.md]
- Key interfaces: GetCurrentInputMode(), UpdateInputPrompts(), RebindAction() [Source: architecture/components.md]
- Dependencies: Steam Input API, UE5 Enhanced Input, Controller Detection [Source: architecture/components.md]
- Technology: C++20, UE5 Enhanced Input, Steam Input API [Source: architecture/components.md]

**Enhanced Input System Integration:**
- Input Action and Mapping Context management
- Multiple device support with context switching
- Action modifiers for sensitivity and dead zones
- Runtime remapping capabilities

**NEON UI Integration:**
- Dynamic input prompt components in UI [Source: architecture/frontend-architecture.md]
- Real-time prompt updates via NEON bridge [Source: architecture/frontend-architecture.md]
- Input mode change listeners in GameStateManager [Source: architecture/frontend-architecture.md]

**Steam Input API Integration:**
- Steam Deck compatibility and optimization [Source: architecture/tech-stack.md]
- Controller auto-detection [Source: architecture/tech-stack.md]
- Platform-specific input handling
- Steam overlay integration

**SettingsSubsystem Integration:**
- Input settings persistence and validation [Source: architecture/components.md]
- UpdateInputSettings() and ValidateSettingsChange() interfaces [Source: architecture/components.md]
- Steam Cloud synchronization for settings [Source: architecture/components.md]

**Multi-Platform Considerations:**
- Xbox controller support with proper button mappings
- PlayStation controller support with Sony button layout
- Steam Deck trackpad and additional button support
- Keyboard/mouse precision vs gamepad comfort
- UI scaling and prompt visibility across devices

**Previous Story Context:**
Story 3.3 completed interaction system with E key functionality, providing the complete character controller that this input framework will make accessible across all input devices.

### Testing

**Testing Approach:**
- UE5 Automation Framework for input system testing [Source: architecture/tech-stack.md]
- Manual testing with multiple controller types [Source: architecture/tech-stack.md]
- Steam Deck hardware testing for compatibility [Source: architecture/tech-stack.md]
- UI testing for prompt accuracy across devices [Source: architecture/tech-stack.md]

**Key Test Scenarios:**
- Input device switching works seamlessly
- All character functions accessible on all devices
- UI prompts update correctly for active device
- Steam Deck specific features function properly

**Success Criteria:**
- Automatic input switching functions reliably
- All movement and interaction controls mapped correctly
- Dynamic UI prompts display accurate information
- Steam Deck compatibility verified and optimized

## Change Log

| Date | Version | Description | Author |
|------|---------|-------------|--------|
| 2024-01-01 | 1.0 | Initial story creation | Scrum Master |

## Dev Agent Record

### Agent Model Used
_To be filled by development agent_

### Debug Log References
_To be filled by development agent_

### Completion Notes List
_To be filled by development agent_

### File List
_To be filled by development agent_

## QA Results

_To be filled by QA agent_